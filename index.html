<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Russian Roulette</title>
    <style>
        body {
            font-family: sans-serif;
            text-align: center;
            transition: background-color 0.5s ease;
        }
        button {
            padding: 20px 40px;
            font-size: 24px;
            margin-top: 20px;
            background-color: #4CAF50;
            border: none;
            color: white;
            text-align: center;
            text-decoration: none;
            display: inline-block;
            cursor: pointer;
            border-radius: 5px;
            transition: background-color 0.3s ease;
        }
        button:disabled {
            background-color: #cccccc;
            cursor: default;
        }
        #result {
            font-size: 20px;
            margin-top: 20px;
        }
        #waiting {
            display: none;
            font-style: italic;
            color: gray;
        }
        #odds {
            font-size: 18px;
            margin-top: 10px;
        }
        footer {
            position: fixed;
            left: 0;
            bottom: 0;
            width: 100%;
            background-color: #f0f0f0;
            text-align: center;
            padding: 10px;
            font-size: 16px;
        }
        .green-bg {
            background-color: #90ee90;
        }
        .red-bg {
            background-color: #ffcccb;
        }
        .revolver-wrapper {
            perspective: 1000px;
            margin: 20px auto;
            width: 200px;
            height: 200px;
        }

        .revolver-chamber {
            width: 200px;
            height: 200px;
            position: relative;
            transform-style: preserve-3d;
            animation: none;
        }

        .chamber {
            position: absolute;
            width: 40px;
            height: 40px;
            background: #444;
            border-radius: 50%;
            border: 2px solid #333;
            left: 50%;
            top: 50%;
            margin: -20px 0 0 -20px;
        }

        /* Chamber positions with chamber1 at 12 o'clock */
        .chamber1 { transform: rotate(0deg) translateY(-80px); }
        .chamber2 { transform: rotate(60deg) translateY(-80px); }
        .chamber3 { transform: rotate(120deg) translateY(-80px); }
        .chamber4 { transform: rotate(180deg) translateY(-80px); }
        .chamber5 { transform: rotate(240deg) translateY(-80px); }
        .chamber6 { transform: rotate(300deg) translateY(-80px); }

        .center-pin {
            position: absolute;
            width: 30px;
            height: 30px;
            background: #666;
            border-radius: 50%;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            border: 2px solid #333;
            z-index: 1;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(3600deg); }
        }

        .spinning {
            animation: spin 2s cubic-bezier(0.1, 0.7, 0.5, 1);
        }

        .chamber.active {
            background: #666;
            box-shadow: inset 0 0 10px rgba(255, 0, 0, 0.5);
        }

        .chamber.empty {
            background: #333;
        }
        @keyframes dimLight {
            0% { filter: brightness(1); }
            50% { filter: brightness(0.7); }
            100% { filter: brightness(1); }
            
        }
    </style>
</head>
<body>
    <h1>Russian Roulette</h1>
    <button id="spinButton" onclick="spin()">Pull the Trigger</button>
    <button id="resetButton" onclick="resetGame()" style="display: none; background-color: #008CBA;">Reset Table</button>
    <div id="result"></div>
    <div id="waiting">...</div>
    <div id="odds">Probability of survival: 100.00%</div>
    <div class="revolver-wrapper">
        <div class="revolver-chamber">
            <div class="chamber chamber1"></div>
            <div class="chamber chamber2"></div>
            <div class="chamber chamber3"></div>
            <div class="chamber chamber4"></div>
            <div class="chamber chamber5"></div>
            <div class="chamber chamber6"></div>
            <div class="center-pin"></div>
        </div>
    </div>
    <footer>Human: <span id="humanScore">0</span> - Computer: <span id="computerScore">0</span></footer>

    <script>
        let spinButton = document.getElementById('spinButton');
        let resetButton = document.getElementById('resetButton');
        let resultDiv = document.getElementById('result');
        let waitingDiv = document.getElementById('waiting');
        let oddsDiv = document.getElementById('odds');
        let humanScoreSpan = document.getElementById('humanScore');
        let computerScoreSpan = document.getElementById('computerScore');
        let body = document.body;
        let humanScore = 0;
        let computerScore = 0;
        
        let spinSound = new Audio('spin.mp3');
        let gunshotSound = new Audio('gunshot.mp3');
        let takeSound = new Audio('take.mp3');
        let heartbeatSound = new Audio('heartbeat.mp3');
        let clickSound = new Audio('click.mp3');

        let safeMessages = [
            "Phew...",
            "Safe, for now...",
            "A close call!",
            "One more, and it would have...",
            "Lucky you!",
            "Still breathing.",
            "Luckiest person alive.",
            "You're dancing with death."
        ];
        let spinSoundPlayed = false; // Flag to check if spin sound has been played
        let currentRotation = 0;

        function updateOddsText(text) {
            oddsDiv.textContent = text;
        }

        function updateOdds() {
            let remainingChambers = 6 - chamber; // Six bullets
            let probabilityFraction = `${remainingChambers}/6`;
            updateOddsText(`Probability of survival: ${probabilityFraction}`);
        }

        function spin() {
            if (gameOver) return;

            const revolverChamber = document.querySelector('.revolver-chamber');
            spinButton.disabled = true;
            waitingDiv.style.display = "block";
            resultDiv.textContent = "";
            body.classList.remove("green-bg", "red-bg");
            
            if (!spinSoundPlayed) {
                // Calculate initial rotation to align bullet with firing position
                currentRotation = ((6 - bulletChamber) * 60) % 360;
                revolverChamber.style.transform = `rotate(${currentRotation}deg)`;
                revolverChamber.classList.remove('spinning');
                void revolverChamber.offsetWidth;
                revolverChamber.classList.add('spinning');
                spinSound.play();
                spinSoundPlayed = true;
                
                // Clear all visual indicators after spin starts
                setTimeout(() => {
                    document.querySelectorAll('.chamber').forEach(ch => {
                        ch.classList.remove('active', 'empty');
                    });
                }, 100); // Short delay to ensure spin animation has started
            } else {
                // Rotate one chamber clockwise
                currentRotation = (currentRotation + 60) % 360;
                revolverChamber.style.transform = `rotate(${currentRotation}deg)`;
            }
            
            heartbeatSound.play();

            setTimeout(() => {
                chamber++;
                updateChamberVisuals();
                updateOdds();

                if (chamber === bulletChamber) {
                    resultDiv.textContent = "BANG! You lose!";
                    gunshotSound.play();
                    body.classList.add("red-bg");
                    computerScore++;
                    computerScoreSpan.textContent = computerScore;
                    gameOver = true;
                    spinButton.style.display = "none";
                    resetButton.style.display = "inline-block";
                } else {
                    clickSound.play(); // Play click sound
                    let randomIndex = Math.floor(Math.random() * safeMessages.length);
                    resultDiv.textContent = safeMessages[randomIndex];
                    body.classList.add("green-bg");
                    spinButton.textContent = "Wait..."; // Change button text to "Wait..."
                    setTimeout(computerTurn, 3000); // Delay before computer's turn
                }
                waitingDiv.style.display = "none"; 
            }, 4000);
        }

        function computerTurn() {
            if (gameOver) return;

            takeSound.play(); // Play take sound
            spinButton.disabled = true;
            spinButton.textContent = "Wait..."; // Change button text to "Wait..."
            waitingDiv.style.display = "block";
            resultDiv.textContent = "Computer's turn...";
            body.classList.remove("green-bg", "red-bg");
            updateOdds();

            setTimeout(() => {
                chamber++;
                updateChamberVisuals();
                updateOdds();

                if (chamber === bulletChamber) {
                    resultDiv.textContent = "BANG! Computer loses!";
                    gunshotSound.play();
                    body.classList.add("red-bg");
                    humanScore++;
                    humanScoreSpan.textContent = humanScore;
                    gameOver = true;
                    spinButton.style.display = "none";
                    resetButton.style.display = "inline-block";
                } else {
                    clickSound.play(); // Play click sound
                    let randomIndex = Math.floor(Math.random() * safeMessages.length);
                    resultDiv.textContent = safeMessages[randomIndex];
                    body.classList.add("green-bg");
                    spinButton.textContent = "Pull the Trigger"; // Change button text back to "Pull the Trigger"
                    spinButton.disabled = false; // Re-enable the button after the computer's turn
                }
                waitingDiv.style.display = "none"; 
            }, 4000);
        }

        function updateChamberVisuals() {
            const chambers = document.querySelectorAll('.chamber');
            chambers.forEach((ch, index) => {
                ch.classList.remove('active', 'empty');
                if (index + 1 === chamber) {
                    ch.classList.add('active');
                }
                else if (index + 1 < chamber) {
                    ch.classList.add('empty');
                }
            });
        }

        function resetGame() {
            chamber = 0;
            bulletChamber = Math.floor(Math.random() * 6) + 1;
            gameOver = false;
            resultDiv.textContent = "";
            body.classList.remove("green-bg", "red-bg");
            spinButton.style.display = "inline-block";
            resetButton.style.display = "none";
            spinSoundPlayed = false;
            spinButton.disabled = false;
            spinButton.textContent = "Pull the Trigger";
            
            const revolverChamber = document.querySelector('.revolver-chamber');
            // Calculate initial rotation based on new bulletChamber
            currentRotation = ((6 - bulletChamber) * 60) % 360;
            revolverChamber.style.transform = `rotate(${currentRotation}deg)`;
            revolverChamber.classList.remove('spinning');
            
            // Clear all chamber indicators first
            document.querySelectorAll('.chamber').forEach(ch => {
                ch.classList.remove('active', 'empty');
            });
            
            // Show the initial bullet chamber
            document.querySelector(`.chamber${bulletChamber}`).classList.add('active');
            
            updateOdds();
        }

        // Initialize the game
        let chamber = 0;
        let bulletChamber;
        let gameOver = false;

        resetGame(); // Call resetGame initially
    </script>
</body>
</html>
